<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Problema Barra - Física</title>

    <!-- TikZJax -->
    <link rel="stylesheet" type="text/css" href="https://tikzjax.com/v1/fonts.css">
    <script src="https://tikzjax.com/v1/tikzjax.js"></script>

    <!-- MathJax -->
    <script>
        MathJax = {
            tex: {
                inlineMath: [['$', '$'], ['\\(', '\\)']],
                displayMath: [['$$', '$$'], ['\\[', '\\]']],
                macros: {
                    unit: ['\\mathrm{#1}', 1]
                }
            },
            svg: {
                fontCache: 'global'
            }
        };
    </script>
    <script type="text/javascript" id="MathJax-script" async
        src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-svg.js">
        </script>

    <!-- Mermaid for flowcharts -->
    <script type="module">
        import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10/dist/mermaid.esm.min.mjs';
        mermaid.initialize({
            startOnLoad: true,
            theme: 'dark',
            themeVariables: {
                primaryColor: '#a6e22e',
                primaryTextColor: '#272822',
                primaryBorderColor: '#75715e',
                lineColor: '#75715e',
                secondaryColor: '#66d9ef',
                tertiaryColor: '#f92672',
                background: '#272822',
                mainBkg: '#272822',
                textColor: '#f8f8f2',
                fontSize: '16px'
            }
        });
    </script>

    <style>
        :root {
            --bg-color: #272822;
            --text-color: #f8f8f2;
            --box-bg: #3e3d32;
            --box-border: #75715e;
            --accent-blue: #66d9ef;
            --accent-green: #e6db74;
            --accent-orange: #fd971f;
            --accent-purple: #ae81ff;
            --accent-red: #f92672;
        }

        body {
            background-color: var(--bg-color);
            color: var(--text-color);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            margin: 0;
            padding: 2rem;
            display: flex;
            justify-content: center;
        }

        .container {
            max-width: 800px;
            width: 100%;
        }

        .tcolorbox {
            background-color: var(--box-bg);
            border: 1px solid var(--box-border);
            border-radius: 4px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.3);
        }

        .tcolorbox.planteamiento {
            border-left: 5px solid var(--accent-green);
        }

        .solution-section h2 {
            color: var(--accent-green);
            border-bottom: 1px solid var(--box-border);
            padding-bottom: 0.5rem;
            margin-top: 2rem;
        }

        .highlight-box {
            border: 1px dashed var(--accent-red);
            padding: 1rem;
            text-align: center;
            background-color: rgba(249, 38, 114, 0.1);
            margin: 1rem 0;
        }

        /* MathJax Adjustments */
        .mjx-chtml {
            color: var(--text-color) !important;
        }

        /* Center content */
        .center-content {
            display: flex;
            justify-content: center;
            margin: 1rem 0;
        }

        /* Two-Column Grid Layout */
        .solution-grid {
            display: grid;
            grid-template-columns: 30% 70%;
            margin-top: 1rem;
            width: 100%;
        }

        .solution-row {
            display: contents;
            /* Allows children to participate in the grid directly, or we can use subgrids */
        }

        /* Actually, using 'display: contents' might make borders tricky. 
           Let's use a explicit flex row or keep the grid on the parent and place items.
           Better approach for the specific border requirement:
           Row wrapper using flex, or Grid with a border on the left cell.
        */

        .solution-block {
            display: flex;
            border-bottom: 1px dotted rgba(255, 255, 255, 0.05);
            /* Optional: subtle row separator */
            margin-bottom: 1rem;
            /* Minimum spacing between blocks */
            padding-bottom: 1rem;
        }

        .solution-block:last-child {
            margin-bottom: 0;
            border-bottom: none;
        }

        .col-text {
            width: 30%;
            padding-right: 1.5rem;
            border-right: 1px dashed var(--monokai-text-dim, #75715e);
            display: flex;
            align-items: flex-start;
            /* Vertically align text to the top */
            justify-content: flex-end;
            /* Align text to the border */
            text-align: right;
            color: var(--accent-green);
            font-size: 0.95em;
        }

        /* Hide border if explicitly requested or empty (optional, but class is safer) */
        .solution-block.no-label .col-text {
            border-right: none;
        }

        .col-math {
            width: 70%;
            padding-left: 1.5rem;
            display: flex;
            align-items: center;
        }

        /* Remove default margins for smoother alignment */
        .col-text p,
        .col-math p {
            margin: 0;
        }

        /* Interactive Math */
        .interactive-math {
            border: 2px solid transparent;
            /* Reserve space/layout but transparent */
            border-radius: 4px;
            padding: 0.5rem;
            cursor: pointer;
            transition: border-color 0.2s ease;
        }

        .interactive-math:hover {
            border-color: var(--accent-red);
            background-color: rgba(249, 38, 114, 0.05);
        }

        /* Modal */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .modal-overlay.active {
            display: flex;
        }

        .modal-content {
            background-color: var(--box-bg);
            border: 1px solid var(--accent-green);
            padding: 2rem;
            border-radius: 8px;
            max-width: 500px;
            width: 90%;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.5);
            position: relative;
        }

        .modal-close {
            position: absolute;
            top: 10px;
            right: 15px;
            color: var(--monokai-text-dim, #ccc);
            font-size: 1.5rem;
            cursor: pointer;
            font-weight: bold;
        }

        .modal-close:hover {
            color: var(--accent-red);
        }

        .solution-text-separator {
            width: 100%;
            margin: 1.5rem 0;
            text-align: center;
            color: var(--text-color);
            font-size: 0.95em;
            padding: 0 1rem;
        }

        @media (max-width: 768px) {
            .solution-block {
                flex-direction: column;
            }

            .col-text,
            .col-math {
                width: 100%;
                border-right: none;
                justify-content: flex-start;
                text-align: left;
                padding: 0.5rem 0;
            }

            .col-text {
                border-bottom: 1px dashed var(--box-border);
            }
        }

        /* Math Interaction Styles */
        .math-term-source,
        .math-term-target {
            display: inline-block !important;
            padding: 4px !important;
            border: 1px solid transparent !important;
            /* "Recuadro transparente" */
            border-radius: 6px;
            cursor: default;
            /* Target overrides this */
            position: relative;
            z-index: 10;
            transition: all 0.2s;
        }

        .math-term-target {
            cursor: pointer;
            /* Extra margin adjustment if needed, or just let it flow */
        }

        /* Visual styling now handled by LaTeX \bbox */

        /* Org Chart Styles */
        .org-chart {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 3rem;
        }

        .chart-level {
            display: flex;
            justify-content: center;
            gap: 3rem;
            width: 100%;
        }

        .chart-level.split {
            gap: 2rem;
        }

        .chart-level.triple {
            gap: 2.5rem;
            max-width: 1000px;
            margin: 0 auto;
        }

        .chart-node {
            background: var(--monokai-bg);
            border: 1px solid var(--box-border);
            border-radius: 6px;
            padding: 1.2rem 1.5rem;
            min-width: 200px;
            max-width: 250px;
            text-align: center;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .chart-node:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
        }

        .chart-node.small {
            min-width: 160px;
            max-width: 180px;
            padding: 1rem 1.2rem;
        }

        .node-title {
            font-size: 0.75em;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: var(--monokai-text-dim);
            margin-bottom: 0.5rem;
            font-weight: 600;
        }

        .node-content {
            font-size: 1em;
            color: var(--monokai-fg);
            font-weight: 500;
        }

        .node-content.small {
            font-size: 0.9em;
        }

        /* Connecting Lines */
        .vertical-line {
            width: 2px;
            height: 40px;
            margin: 0 auto;
        }

        .vertical-line.short {
            height: 30px;
        }

        .horizontal-line {
            height: 2px;
            width: 60%;
            margin: 0 auto;
        }

        .horizontal-line.sub {
            width: 50%;
        }

        .branch-container,
        .sub-branch-container,
        .convergence-container {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%;
        }

        .branch-splits,
        .sub-splits {
            display: flex;
            justify-content: space-around;
            width: 60%;
        }

        .sub-splits {
            width: 50%;
        }

        .convergence-lines {
            display: flex;
            justify-content: space-around;
            width: 80%;
        }

        /* Specific hover behavior handled via JS/additional classes usually,
           but baseline style ensures the "box" feel */
        /* Layout Refactor - Single Column */
        /* Layout Refactor - Widened for Side-by-Side Viz */
        .main-layout {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 2rem;
        }

        /* Step Box Internal Layout - Wrapped for Side-by-Side */
        .step-content-wrapper {
            display: flex;
            gap: 2rem;
            align-items: stretch;
            /* Match height */
        }

        .step-viz-col {
            flex: 0 0 40%;
            /* 40% width for Viz */
            min-height: 400px;
            background: transparent;
            /* Transparent to blend with Step 1 box */
            border-radius: 8px;
            overflow: hidden;
            position: relative;
        }

        .step-text-math-col {
            flex: 1;
            /* Remaining space for text/math */
            display: flex;
            flex-direction: column;
            justify-content: center;
            /* Center vertically if viz is taller */
            gap: 2rem;
        }

        /* Internal step-content fits inside the right column */
        .step-content {
            display: flex;
            align-items: stretch;
            /* Stretch to ensure border covers full height */
            gap: 1.5rem;
        }

        .step-text-col {
            flex: 0 0 200px;
            /* Slightly narrower text col inside the split */
            font-size: 0.95em;
            color: #d6d6d6;
        }

        .text-yellow-theme {
            color: #e6db74;
            /* Monokai Yellow */
            border-right: 1px dashed #75715e;
            /* Attenuated separator (like Vectorialmente) */
            /* Thinner separator (standard) */
            padding-right: 1.5rem;
            text-align: right;
        }

        .step-math-col {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .inline-viz {
            width: 100%;
            height: 300px;
            border: 1px solid var(--box-border);
            border-radius: 8px;
            background: #000;
        }

        /* Step Box Style DO NOT REMOVE */
        .step-box {
            background: rgba(255, 255, 255, 0.02);
            border: 1px solid var(--box-border);
            border-radius: 8px;
            padding: 2rem;
            margin: 2rem 0;
            position: relative;
        }

        .step-label {
            position: absolute;
            top: -12px;
            left: 20px;
            background: var(--bg-color);
            /* Matches page bg */
            padding: 0 10px;
            color: var(--accent-green);
            font-size: 0.85em;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            font-weight: bold;
            border: 1px solid var(--box-border);
            border-radius: 4px;
        }

        iframe.viz-frame {
            width: 100%;
            height: 100%;
            border: none;
        }
    </style>

    <div class="main-layout">



        <script>
            // Mouse Follow Tooltip Logic
            document.addEventListener('DOMContentLoaded', () => {
                function setupTooltip(triggerElement, tooltipId) {
                    const tooltip = document.getElementById(tooltipId);
                    if (!triggerElement || !tooltip) return;
                    triggerElement.addEventListener('mouseenter', () => {
                        tooltip.style.display = 'block';
                        updatePosition(triggerElement, tooltip);
                        if (window.MathJax && window.MathJax.typesetPromise) {
                            MathJax.typesetPromise([tooltip]);
                        }
                    });
                    triggerElement.addEventListener('mouseleave', () => {
                        tooltip.style.display = 'none';
                    });
                }

                // Only for standard hover triggers
                const textTriggers = document.querySelectorAll('.hover-trigger[data-tooltip]');
                textTriggers.forEach(t => setupTooltip(t, t.dataset.tooltip));

                function updatePosition(target, tooltipEl) {
                    const rect = target.getBoundingClientRect();
                    const scrollY = window.scrollY || window.pageYOffset;
                    const scrollX = window.scrollX || window.pageXOffset;
                    let top = rect.top + scrollY - tooltipEl.offsetHeight - 15;
                    let left = rect.left + scrollX + (rect.width / 2) - (tooltipEl.offsetWidth / 2);
                    if (left < 10) left = 10;
                    if (left + tooltipEl.offsetWidth > window.innerWidth - 10) {
                        left = window.innerWidth - tooltipEl.offsetWidth - 10;
                    }
                    tooltipEl.style.top = `${top}px`;
                    tooltipEl.style.left = `${left}px`;
                }
            });
            // SCROLL LISTENER REMOVED as requested
        </script>

        <div class="content-scroll">
            <!-- Step 0: Enunciado (Problem Statement) -->
            <div class="step-box">
                <span class="step-label">Enunciado del Problema</span>

                <div class="step-content-wrapper">
                    <!-- Left Column: Visualization (Geometry Only) -->
                    <div class="step-viz-col">
                        <iframe src="initial_interactive.html?v=3" class="viz-frame" id="viz-step-0"
                            scrolling="no"></iframe>
                    </div>

                    <!-- Right Column: Text -->
                    <div class="step-text-math-col">
                        <div class="step-content">
                            <div class="step-text-col text-yellow-theme"
                                style="flex: 1; border: none; text-align: left;">
                                <p>Una barra de longitud \(L\) se encuentra en dirección perpendicular a una carga
                                    lineal uniforme e infinitamente larga de densidad de carga \(\lambda\) \(\frac {
                                    \unit { C } } { \unit { m } } \).</p>
                                <p style="margin-top: 1rem;">El extremo más próximo de la barra a la carga lineal dista
                                    de esta la longitud \(d\).</p>
                                <p style="margin-top: 1rem;">La barra posee una carga total \(\mathrm { Q } \)
                                    distribuida uniformemente en toda su longitud.</p>
                                <p style="margin-top: 1rem;">Determinar la fuerza que la carga lineal ejerce sobre la
                                    barra.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </div>



            <!-- Step 1: Gauss (Standardized Split Blocks) -->
            <!-- Step 1: Gauss (Side-by-Side: Viz Left | Text/Math Right) -->
            <div class="step-box">
                <span class="step-label">Paso 1: Calcular Campo Eléctrico</span>

                <div class="step-content-wrapper">
                    <!-- Left Column: Visualization -->
                    <div class="step-viz-col">
                        <iframe src="final_interactive.html?v=11" class="viz-frame" id="viz-step-1"
                            scrolling="no"></iframe>
                    </div>

                    <!-- Right Column: Text & Math Rows -->
                    <div class="step-text-math-col">

                        <!-- 1. Flux Integral -->
                        <div class="step-content">
                            <div class="step-text-col text-yellow-theme">
                                <p>Calcula el flujo del campo Eléctrico (\(\vec{E}\)) que atraviesa la superficie
                                    gaussiana \(S\) (de radio \(r\) y longitud \(L'\)).</p>
                            </div>
                            <div class="step-math-col">
                                <div style="font-size: 1.1em; overflow-x: auto;">
                                    \begin{align*}
                                    \oint_S \vec{E} \cdot d\vec{S} &= \oint_S E dS = E \oint_S dS =
                                    \class{math-term-source-2}{E (2\pi r L')}
                                    \end{align*}
                                </div>
                            </div>
                        </div>

                        <!-- 2. Enclosed Charge -->
                        <div class="step-content">
                            <div class="step-text-col text-yellow-theme">
                                <p>Las unidades de \(\lambda\) son \(\frac{Q}{m}\).</p>
                            </div>
                            <div class="step-math-col">
                                <div style="font-size: 1.1em; overflow-x: auto;">
                                    \begin{align*}
                                    \mathrm{Q}_{\text{enc}} &= \class{math-term-source}{\lambda L'}
                                    \end{align*}
                                </div>
                            </div>
                        </div>

                        <!-- 3. Gauss Law Relation & Scalar Result -->
                        <div class="step-content">
                            <div class="step-text-col text-yellow-theme">
                                <p>Según la Ley de Gauss, podemos relacionar ambas expresiones y despejar \(E\).</p>
                            </div>
                            <div class="step-math-col">
                                <div style="font-size: 1.1em; overflow-x: auto;">
                                    \begin{align*}
                                    \class{math-term-target-2}{\bbox[4px,border:1px dashed
                                    #a6e22e;border-radius:8px,#272822]{E (2\pi r L')}} &=
                                    \frac{\class{math-term-target}{\bbox[4px,border:1px dashed
                                    #f92672;border-radius:8px,#272822]{\lambda L'}}}{\varepsilon_0} \\[10pt]
                                    E &= \frac{\lambda}{2\pi \varepsilon_0 r} \quad
                                    \left[\frac{\unit{N}}{\unit{C}}\right]
                                    \end{align*}
                                </div>
                            </div>
                        </div>

                        <!-- 4. Vector Result -->
                        <div class="step-content">
                            <div class="step-text-col text-yellow-theme">
                                <p>Finalmente:</p>
                            </div>
                            <div class="step-math-col">
                                <div style="font-size: 1.1em; overflow-x: auto;">
                                    \begin{align*}
                                    \vec{E} &= \frac{\lambda}{2\pi \varepsilon_0 r} \hat{r} \quad
                                    \left[\frac{\unit{N}}{\unit{C}}\right]
                                    \end{align*}
                                </div>
                            </div>
                        </div>

                    </div>
                </div>
            </div>

            <!-- Step 2: Vector Projection -->
            <div class="step-box">
                <span class="step-label">Paso 2: Expresión Vectorial</span>

                <div class="step-content-wrapper">
                    <!-- Left Column: Visualization (Step 2 - Only Pos Y Field) -->
                    <div class="step-viz-col">
                        <iframe src="step2_interactive.html" class="viz-frame" id="viz-step-2" scrolling="no"></iframe>
                    </div>

                    <!-- Right Column: Text & Math -->
                    <div class="step-text-math-col">

                        <!-- 1. Intro Text -->
                        <div class="step-content">
                            <div class="step-text-col text-yellow-theme"
                                style="flex: 1; border: none; text-align: left;">
                                <p style="margin-top: 1rem;">La dirección del campo eléctrico concretamente en la
                                    barra de longitud \(L\) (en todos sus puntos) es vertical.</p>
                            </div>
                        </div>

                        <!-- 2. Vector Equation -->
                        <div class="step-content">
                            <div class="step-text-col text-yellow-theme">
                                <p>Vectorialmente:</p>
                            </div>
                            <div class="step-math-col">
                                <div style="font-size: 1.1em; overflow-x: auto;">
                                    \begin{align*}
                                    \vec{E} &= \frac{\lambda}{2\pi \varepsilon_0 y} \, \hat{j} \quad
                                    \left[\frac{\unit{N}}{\unit{C}}\right]
                                    \end{align*}
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="solution-text-separator" id="section-differential">
                La fuerza eléctrica se calcula como el producto del campo eléctrico por la carga en dicho
                punto. Como en la barra de longitud \(L\), esta está situada en la misma dirección de
                variación del campo eléctrico, entonces tenemos que recurrir a la integración.
            </div>

            <!-- Block 4: Por otro lado -->
            <div class="solution-block">
                <div class="col-text">
                    Por otro lado, calculamos la fuerza como:
                </div>
                <div class="col-math">
                    $$ \vec{F} = \int d\vec{F} $$
                </div>
            </div>

            <!-- Block 5: Donde -->
            <div class="solution-block">
                <div class="col-text">
                    Donde:
                </div>
                <div class="col-math">
                    $$ d\vec{F} = \vec{E} \, dq $$
                </div>
            </div>

            <!-- Block 6: Y (with sidenote) -->
            <div class="solution-block">
                <div class="col-text">
                    Y:
                </div>
                <div class="col-math">
                    <div class="sidenote-container" style="justify-content: flex-start; margin: 0; width: 100%;">
                        <div class="highlight-box" style="margin: 0;">
                            $$ dq = \frac{\mathrm{Q}}{L} \, dy $$
                        </div>
                        <div class="sidenote">
                            distribución lineal del segmento vertical finito
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal -->
    <div id="math-modal" class="modal-overlay">
        <div class="modal-content">
            <span class="modal-close">&times;</span>
            <div id="modal-body-text">
                <!-- Content injected via JS -->
            </div>
        </div>
    </div>
    </div>

    <script>
        // Modal Logic
        document.addEventListener('DOMContentLoaded', () => {
            const modal = document.getElementById('math-modal');
            const closeBtn = document.querySelector('.modal-close');
            const triggers = document.querySelectorAll('.interactive-math');
            const bodyText = document.getElementById('modal-body-text');

            const contentMap = {
                'planteamiento': `
                                <h3 style="color: var(--accent-green); margin-top: 0;">Planteamiento</h3>
                                <p>La ley de Gauss relaciona el flujo eléctrico que atraviesa una superficie cualquiera cerrada $S$
                                    con la carga encerrada por la misma: </p>
                                $$ \\oint_S \\vec{E} \\cdot d\\vec{S} = \\frac{\\mathrm{Q}_{\\text{enc}}}{\\varepsilon_0} $$
                                <p>Por otro lado, la fuerza se relaciona con el campo eléctrico como: </p>
                                $$ d\\vec{F} = \\vec{E} \\, dq $$
                                `,
                'default': `
                                <h3 style="color: var(--accent-green); margin-top: 0;">Detalle Matemático</h3>
                                <p>Partimos de la Ley de Gauss general:</p>
                                $$ \\oint_S \\vec{E} \\cdot d\\vec{S} = \\frac{\\mathrm{Q}_{\\text{enc}}}{\\varepsilon_0} $$
                                `
            };

            triggers.forEach(trigger => {
                trigger.addEventListener('click', () => {
                    const type = trigger.getAttribute('data-modal') || 'default';
                    bodyText.innerHTML = contentMap[type];
                    // Retrigger MathJax
                    if (window.MathJax) {
                        MathJax.typesetPromise ? MathJax.typesetPromise([bodyText]) : MathJax.Hub.Queue(["Typeset", MathJax.Hub, bodyText]);
                    }
                    modal.classList.add('active');
                });
            });

            closeBtn.addEventListener('click', () => {
                modal.classList.remove('active');
            });

            // Close on outside click
            modal.addEventListener('click', (e) => {
                if (e.target === modal) {
                    modal.classList.remove('active');
                }
            });
        });
    </script>
    <!-- LeaderLine Library for visual connections -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leader-line/1.0.7/leader-line.min.js"></script>

    <script>
        // ... Existing modal script ...

        // Equation Linking Logic
        document.addEventListener('DOMContentLoaded', () => {
            function safeInit() {
                initEquationLinking();
            }

            // Standard MathJax 2.x method
            if (window.MathJax && window.MathJax.Hub) {
                window.MathJax.Hub.Queue(safeInit);
            }
            // MathJax 3.x promise method
            else if (window.MathJax && window.MathJax.startup) {
                window.MathJax.startup.promise.then(safeInit);
            }
            // Fallback for race conditions
            setTimeout(safeInit, 2000);
        });

        function initEquationLinking() {
            const sources = document.getElementsByClassName('math-term-source');
            const targets = document.getElementsByClassName('math-term-target');

            if (sources.length === 0 || targets.length === 0) return;

            const source = sources[0];
            const target = targets[0];
            let line = null;

            // Hover styles for Target applied via CSS classes mostly, but we trigger the connection here

            target.addEventListener('mouseenter', () => {
                // Boxes are now permanently styled via LaTeX \bbox
                // Just draw the connecting line

                // Draw Line
                if (window.LeaderLine) {
                    line = new LeaderLine(
                        source,
                        target,
                        {
                            color: '#f92672', // Monokai Red
                            size: 2,
                            path: 'grid',
                            startSocket: 'right',
                            endSocket: 'right',
                            startPlug: 'disc',
                            endPlug: 'arrow3',
                            dash: { animation: true }
                        }
                    );
                }
            });

            const removeLine = () => {
                if (line) {
                    line.remove();
                    line = null;
                }
            };

            target.addEventListener('mouseleave', removeLine);

            // Safety cleanup on scroll/resize just in case, though LeaderLine handles it usually.
            window.addEventListener('scroll', removeLine);

            // Second pair: E(2πrL') with green arrow
            const sources2 = document.getElementsByClassName('math-term-source-2');
            const targets2 = document.getElementsByClassName('math-term-target-2');

            if (sources2.length > 0 && targets2.length > 0) {
                const source2 = sources2[0];
                const target2 = targets2[0];
                let line2 = null;

                target2.addEventListener('mouseenter', () => {
                    if (window.LeaderLine) {
                        line2 = new LeaderLine(
                            source2,
                            target2,
                            {
                                color: '#a6e22e', // Monokai Green
                                size: 2,
                                path: 'grid',
                                startSocket: 'bottom',
                                endSocket: 'right',
                                startPlug: 'disc',
                                endPlug: 'arrow3',
                                dash: { animation: true }
                            }
                        );
                    }
                });

                const removeLine2 = () => {
                    if (line2) {
                        line2.remove();
                        line2 = null;
                    }
                };

                target2.addEventListener('mouseleave', removeLine2);
                window.addEventListener('scroll', removeLine2);
            }
        }
    </script>
    <script>
        // Scroll Interaction for Field Overlay and Gaussian Cylinder
        document.addEventListener('DOMContentLoaded', () => {
            const theorySection = document.getElementById('theory-section');
            const gaussSection = document.getElementById('gauss-trigger');

            const fieldOverlay = document.querySelector('.field-overlay');
            const gaussianOverlay = document.querySelector('.gaussian-overlay');

            const observerCallback = (entries) => {
                entries.forEach(entry => {
                    if (entry.target.id === 'theory-section') {
                        if (entry.isIntersecting) {
                            fieldOverlay.style.opacity = '1';
                        } else {
                            fieldOverlay.style.opacity = '0';
                        }
                    }
                    if (entry.target.id === 'gauss-trigger') {
                        if (entry.isIntersecting) {
                            gaussianOverlay.style.opacity = '1';
                        } else {
                            gaussianOverlay.style.opacity = '0';
                        }
                    }
                });
            };

            const observer = new IntersectionObserver(observerCallback, {
                threshold: 0.3
            });

            if (theorySection) observer.observe(theorySection);
            if (gaussSection) observer.observe(gaussSection);
        });
    </script>
    <script>
        // Auto-Refresh Logic for Development
        (function () {
            let lastModified = null;
            function checkRefresh() {
                fetch(window.location.href, { method: 'HEAD' })
                    .then(r => {
                        const newModified = r.headers.get('Last-Modified');
                        if (lastModified && newModified && newModified !== lastModified) {
                            console.log("File changed, refreshing...");
                            window.location.reload();
                        }
                        lastModified = newModified;
                    })
                    .catch(e => console.error("Auto-refresh check failed", e));
            }
            setInterval(checkRefresh, 1000);
        })();
    </script>
    </body>

</html>